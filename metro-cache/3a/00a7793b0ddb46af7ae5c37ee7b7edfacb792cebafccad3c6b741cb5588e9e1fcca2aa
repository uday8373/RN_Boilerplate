{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"./state","data":{"isAsync":false}},{"name":"./deprecatedUtils","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.setup = setup;\n  exports.tearDown = tearDown;\n  exports.latest = latest;\n  exports.add = add;\n  exports.remove = remove;\n  exports.default = void 0;\n\n  var _state = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"./state\"));\n\n  var _deprecatedUtils = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[2], \"./deprecatedUtils\"));\n\n  var _isSetup = false;\n\n  var _subscriptions = new Set();\n\n  var _latestState = null;\n\n  function _handler(state) {\n    var convertedState = _deprecatedUtils.default.convertState(state);\n\n    _latestState = convertedState;\n\n    _subscriptions.forEach(function (handler) {\n      return handler(convertedState);\n    });\n  }\n\n  function setup() {\n    if (_isSetup) {\n      return;\n    }\n\n    _state.default.add(_handler);\n  }\n\n  function tearDown() {\n    if (!_isSetup) {\n      return;\n    }\n\n    _state.default.remove(_handler);\n\n    _latestState = null;\n\n    _subscriptions.clear();\n  }\n\n  function latest() {\n    if (_latestState) {\n      return Promise.resolve(_latestState);\n    } else {\n      return _state.default.latest().then(function (state) {\n        _latestState = _deprecatedUtils.default.convertState(state);\n        return _latestState;\n      });\n    }\n  }\n\n  function add(handler) {\n    _subscriptions.add(handler);\n\n    if (_latestState) {\n      handler(_latestState);\n    } else {\n      latest().then(handler);\n    }\n  }\n\n  function remove(handler) {\n    _subscriptions.delete(handler);\n  }\n\n  var _default = {\n    setup: setup,\n    tearDown: tearDown,\n    latest: latest,\n    add: add,\n    remove: remove\n  };\n  exports.default = _default;\n});","map":[[14,0,10,0],[16,0,13,0],[18,0,15,0],[18,6,15,4,"_isSetup"],[18,14,15,12],[18,17,15,15],[18,22,15,0],[20,0,16,0],[20,6,16,6,"_subscriptions"],[20,20,16,20],[20,23,16,23],[20,27,16,27,"Set"],[20,30,16,23],[20,32,16,0],[22,0,17,0],[22,6,17,4,"_latestState"],[22,18,17,52],[22,21,17,55],[22,25,17,0],[24,0,19,0],[24,11,19,9,"_handler"],[24,19,19,0],[24,20,19,18,"state"],[24,25,19,0],[24,27,19,51],[25,0,20,2],[25,8,20,8,"convertedState"],[25,22,20,22],[25,25,20,25,"DeprecatedUtils"],[25,50,20,41,"convertState"],[25,62,20,25],[25,63,20,54,"state"],[25,68,20,25],[25,69,20,2],[27,0,21,2,"_latestState"],[27,4,21,2,"_latestState"],[27,16,21,14],[27,19,21,17,"convertedState"],[27,33,21,2],[29,0,22,2,"_subscriptions"],[29,4,22,2,"_subscriptions"],[29,18,22,16],[29,19,22,17,"forEach"],[29,26,22,2],[29,27,22,25],[29,37,22,26,"handler"],[29,44,22,25],[30,0,22,25],[30,13,22,44,"handler"],[30,20,22,51],[30,21,22,52,"convertedState"],[30,35,22,51],[30,36,22,25],[31,0,22,25],[31,5,22,2],[32,0,23,1],[34,0,25,7],[34,11,25,16,"setup"],[34,16,25,7],[34,19,25,30],[35,0,27,2],[35,8,27,6,"_isSetup"],[35,16,27,2],[35,18,27,16],[36,0,28,4],[37,0,29,3],[39,0,31,2,"State"],[39,19,31,8,"add"],[39,22,31,2],[39,23,31,12,"_handler"],[39,31,31,2],[40,0,32,1],[42,0,34,7],[42,11,34,16,"tearDown"],[42,19,34,7],[42,22,34,33],[43,0,36,2],[43,8,36,6],[43,9,36,7,"_isSetup"],[43,17,36,2],[43,19,36,17],[44,0,37,4],[45,0,38,3],[47,0,40,2,"State"],[47,19,40,8,"remove"],[47,25,40,2],[47,26,40,15,"_handler"],[47,34,40,2],[49,0,41,2,"_latestState"],[49,4,41,2,"_latestState"],[49,16,41,14],[49,19,41,17],[49,23,41,2],[51,0,42,2,"_subscriptions"],[51,4,42,2,"_subscriptions"],[51,18,42,16],[51,19,42,17,"clear"],[51,24,42,2],[52,0,43,1],[54,0,45,7],[54,11,45,16,"latest"],[54,17,45,7],[54,20,45,63],[55,0,46,2],[55,8,46,6,"_latestState"],[55,20,46,2],[55,22,46,20],[56,0,47,4],[56,13,47,11,"Promise"],[56,20,47,18],[56,21,47,19,"resolve"],[56,28,47,11],[56,29,47,27,"_latestState"],[56,41,47,11],[56,42,47,4],[57,0,48,3],[57,5,46,2],[57,11,48,9],[58,0,49,4],[58,13,49,11,"State"],[58,28,49,17,"latest"],[58,34,49,11],[58,37,49,26,"then"],[58,41,49,11],[58,42,50,6],[58,52,50,7,"state"],[58,57,50,6],[58,59,50,46],[59,0,51,8,"_latestState"],[59,8,51,8,"_latestState"],[59,20,51,20],[59,23,51,23,"DeprecatedUtils"],[59,48,51,39,"convertState"],[59,60,51,23],[59,61,51,52,"state"],[59,66,51,23],[59,67,51,8],[60,0,52,8],[60,15,52,15,"_latestState"],[60,27,52,8],[61,0,53,7],[61,7,49,11],[61,8,49,4],[62,0,55,3],[63,0,56,1],[65,0,58,7],[65,11,58,16,"add"],[65,14,58,7],[65,15,58,20,"handler"],[65,22,58,7],[65,24,58,66],[66,0,60,2,"_subscriptions"],[66,4,60,2,"_subscriptions"],[66,18,60,16],[66,19,60,17,"add"],[66,22,60,2],[66,23,60,21,"handler"],[66,30,60,2],[68,0,63,2],[68,8,63,6,"_latestState"],[68,20,63,2],[68,22,63,20],[69,0,64,4,"handler"],[69,6,64,4,"handler"],[69,13,64,11],[69,14,64,12,"_latestState"],[69,26,64,11],[69,27,64,4],[70,0,65,3],[70,5,63,2],[70,11,65,9],[71,0,66,4,"latest"],[71,6,66,4,"latest"],[71,12,66,10],[71,15,66,13,"then"],[71,19,66,4],[71,20,66,18,"handler"],[71,27,66,4],[72,0,67,3],[73,0,68,1],[75,0,70,7],[75,11,70,16,"remove"],[75,17,70,7],[75,18,70,23,"handler"],[75,25,70,7],[75,27,70,69],[76,0,71,2,"_subscriptions"],[76,4,71,2,"_subscriptions"],[76,18,71,16],[76,19,71,17,"delete"],[76,25,71,2],[76,26,71,24,"handler"],[76,33,71,2],[77,0,72,1],[79,17,74,15],[80,0,75,2,"setup"],[80,4,75,2,"setup"],[80,9,75,7],[80,11,75,2,"setup"],[80,16,74,15],[81,0,76,2,"tearDown"],[81,4,76,2,"tearDown"],[81,12,76,10],[81,14,76,2,"tearDown"],[81,22,74,15],[82,0,77,2,"latest"],[82,4,77,2,"latest"],[82,10,77,8],[82,12,77,2,"latest"],[82,18,74,15],[83,0,78,2,"add"],[83,4,78,2,"add"],[83,7,78,5],[83,9,78,2,"add"],[83,12,74,15],[84,0,79,2,"remove"],[84,4,79,2,"remove"],[84,10,79,8],[84,12,79,2,"remove"],[85,0,74,15],[85,3]]},"type":"js/module"}]}